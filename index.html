<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    /* Style the map container */
    #map {
      height: 500px;
      width: 100%;
    }
  </style>
  <title>Aplicativo para Turistas</title>
</head>
<body>
  <h1>Aplicativo para Turistas</h1>

  <p id="info">Aguardando a localização do usuário...</p>
  <div id="map"></div>

  <script>
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      document.getElementById("info").innerHTML = "Geolocation não é suportado pelo seu navegador.";
    }
      
    function showPosition(position) {
        var userLat = position.coords.latitude;
        var userLng = position.coords.longitude;
        console.log("userLat:"+userLat);
        console.log("userLng:"+userLng);
        // Show the location on the map
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8,
            center: {lat: userLat, lng: userLng}
        });

        var marker = new google.maps.Marker({
            position: {lat: userLat, lng: userLng},
            map: map
        });


        var pointsOfInterest = [
            { name: "Teatro Amazonas", lat: -3.133333, lng: -60.021389 },
            { name: "Arena da Amazônia", lat: -3.0832457, lng: -60.0303279 },
            { name: "Praia da Ponta Negra", lat: -3.0646648, lng: -60.1052856 },
            { name: "Amazonas Shopping", lat: -3.0941363, lng: -60.0314493 }
        ];

        var potDistance = new Array();

        for (var i = 0; i < pointsOfInterest.length; i++) {
            var pointOfInterest = pointsOfInterest[i];
            
            var marker = new google.maps.Marker({
            position: {lat: pointOfInterest.lat, lng: pointOfInterest.lng},
            map: map
            });

            var dist = calculateDistance(userLat, userLng, pointOfInterest.lat, pointOfInterest.lng);
            potDistance.push(dist);             
        }
       

        if (potDistance[0] <= 0.5) { // 500 metros
                document.getElementById("info").innerHTML = "Você está próximo do Teatro Amazonas!";

                if (window.DeviceOrientationEvent) {
                    window.addEventListener("deviceorientation", function(event) {
                        document.getElementById("info").innerHTML += "<br>Grau: " + event.alpha;

                        if (event.alpha >= 340 || event.alpha <= 20) {
                            document.getElementById("info").innerHTML += "<br>Você está apontando para o Teatro Amazonas!";
                        } 
                    });
                }
            } else {
                document.getElementById("info").innerHTML = "Você não está próximo do Teatro Amazonas.";
            }
        
        if (potDistance[1] <= 0.5) { // 500 metros
            document.getElementById("info").innerHTML = "Você está próximo da Arena da Amazônia!";

            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", function(event) {
                    document.getElementById("info").innerHTML += "<br>Grau: " + event.alpha;

                    if (event.alpha >= 340 || event.alpha <= 20) {
                        document.getElementById("info").innerHTML += "<br>Você está apontando para Arena da Amazônia!";
                    } 
                });
            }
        } else {
            document.getElementById("info").innerHTML = "Você não está próximo da Arena da Amazônia.";
        }

        if (potDistance[2] <= 0.5) { // 500 metros
            document.getElementById("info").innerHTML = "Você está próximo da Praia da Ponta Negra!";

            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", function(event) {
                    document.getElementById("info").innerHTML += "<br>Grau: " + event.alpha;

                    if (event.alpha >= 340 || event.alpha <= 20) {
                        document.getElementById("info").innerHTML += "<br>Você está apontando para Praia da Ponta Negra!";
                    } 
                });
            }
        } else {
            document.getElementById("info").innerHTML = "Você não está próximo da Praia da Ponta Negra.";
        }

        if (potDistance[3] <= 10) { // 10km
            document.getElementById("info").innerHTML = "Você está próximo do Amazonas Shopping!";

            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", function(event) {

                    document.getElementById("info").innerHTML += "<br>Grau: " + event.alpha;

                    if (event.alpha >= 340 || event.alpha <= 20) {
                        document.getElementById("info").innerHTML += "<br>Você está apontando para o Amazonas Shopping!";
                    } 
                });
            }
        } else {
            document.getElementById("info").innerHTML = "Você não está próximo do Amazonas Shopping.";
        }        
    }

    function calculateDistance(lat1, lng1, lat2, lng2) {
        var radlat1 = Math.PI * lat1/180;
        var radlat2 = Math.PI * lat2/180;
        var theta = lng1-lng2;
        var radtheta = Math.PI * theta/180;
        var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
        dist = Math.acos(dist);
        dist = dist * 180/Math.PI;
        dist = dist * 60 * 1.1515;
        dist = dist * 1.609344;
        return dist;
    }
  
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9-OxqKhVbJ666dnpsUKEZVeu1LQTxGb4&callback">
   </script>
</body>
</html>
